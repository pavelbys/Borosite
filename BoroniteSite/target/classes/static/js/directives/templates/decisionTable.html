<div>
    <!--todo undo/redo for text editing-->
    <!--todo fix buttons-->
    <!--todo sub-tables and parents-->
    <!--todo test data input, data output -->
    <!--todo copy paste cells-->
    <!--todo select multiple cells-->
    <!--todo try out a system with fixed cell width, but editable by user-->
    <!--todo wrap long text-->
    <h3>{{table.name}}</h3>
    <div class="dtEditor">
        <span style="text-decoration: underline">Detailed editor:</span><br>
        Rule: {{selected.rule.name}}<br>
        Class: {{selected.attribute.getParent().name}}<br>
        Attribute: {{selected.attribute.name}}<br>
        <input type="text" ng-model="selected.rule.values[selected.attribute]" ng-focus="focusEditor()" ng-blur="blurEditor()"/>
        <button ng-disabled="true">cancel</button>
        <button ng-disabled="true">done</button>
    </div>
    <table class="decisionTable">
        <colgroup>
            <col>
            <col span="{{table.conditionsSpan()}}" class="dtConditions">
            <col span="{{table.resultsSpan()}}" class="dtResults">
        </colgroup>
        <thead>
        <!-- Categories -->
        <tr class="dtCategories">
            <th>
                Rules
                <button ng-click="addingRule=true">+</button>
            </th>
            <th colspan="{{table.conditionsSpan()}}">
                Conditions
                <button ng-click="addCondition()">+</button>
            </th>
            <th colspan="{{table.resultsSpan()}}">
                Results
                <button ng-click="addResult()">+</button>
            </th>
        </tr>
        <!-- Hit policy and Classes -->
        <tr>
            <th class="dtHitPolicy" rowspan="2">
                Hit policy:
                <select ng-options="option for option in hitPolicyOptions" ng-model="table.hitPolicy" ng-change="afterChange()"></select>
            </th>
            <th class="dtClass" ng-repeat="class in table.classes()" colspan="{{class.attributes.length}}"
                draggable="true" dragover-fix bind-events="{arg: class, functions: dragFunctions}"
                ng-class="{dragging: class.dragging, dragOver: class.dragOver}">
                {{class.name}}
                <button ng-click="editClass(class)">edit</button>
            </th>
        </tr>
        <!-- Attribute headers -->
        <tr>
            <th class="dtAttribute" ng-repeat="attribute in table.attributes()" ng-click="attribute.showDropdown = !attribute.showDropdown"
                draggable="true" dragover-fix bind-events="{arg: attribute, functions: dragFunctions}"
                ng-class="{dragging: attrDragging(attribute), dragOver: attrDragOver(attribute)}">
                {{attribute.name}}
                <ul ng-show="attribute.showDropdown">
                    <li>sort</li>
                    <li ng-click="sortRules(attribute, false)">ascending</li>
                    <li ng-click="sortRules(attribute, true)">descending</li>
                    <li ng-click="removeRuleSort()">remove</li>
                </ul>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr ng-repeat="rule in table.rules">
            <!--rule headers-->
            <th class="dtRule" draggable="true" dragover-fix bind-events="{arg: rule, functions: dragFunctions}"
                ng-class="{dragging: rule.dragging, dragOver: rule.dragOver}">
                {{rule.name}}
                <button ng-click="deleteRule(rule, $index)">x</button>
            </th>
            <!--cell values-->
            <td class="dtCell noSelect" ng-repeat="attribute in table.attributes()"
                ng-dblclick="selectCell(rule, attribute); selected.editing=true; focusRuleInput=true;"
                ng-mousedown="selectCell(rule, attribute)" ng-mouseup="selectCell(rule, attribute)"
                ng-class="{dragging: cellDragging(rule, attribute), dragOver: cellDragOver(rule, attribute), selected: selectedCell(rule, attribute)}">
                <!-- todo multi-select here -->
                <span ng-hide="editingCell(rule, attribute)">
                    {{rule.values[attribute]}}
                </span>
                <span ng-show="editingCell(rule, attribute)">
                    <input type="text" ng-model="rule.values[attribute]" focus-me="{{focusRuleInput}}"
                           ng-focus="selected.focused=true" ng-blur=" blurCell()"/>
                </span>
            </td>
        </tr>
        </tbody>
    </table>
    <div class="dtToolbar">
        <button ng-disabled="!undoRedo.canUndo()" ng-click="undo()">undo</button>
        <button ng-disabled="!undoRedo.canRedo()" ng-click="redo()">redo</button>
    </div>

    <!--global pop-ups-->
    <div pop-up ng-show="addingRule">
        <div>
            Enter name:
            <input type="text" ng-model="newRuleName" ng-keypress="addRuleKeyPress($event)" focus-me="{{addingRule}}"/>
            <button ng-click="doneAddingRule()">cancel</button>
            <button ng-disabled="!newRuleName" ng-click="addRule(newRuleName)">add</button>
        </div>
    </div>
</div>
